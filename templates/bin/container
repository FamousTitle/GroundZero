#!/usr/bin/env ruby

# Check if app name argument is provided
if ARGV.empty?
  puts "Error: Missing arguments"
  puts "Usage: ./run.rb COMMAND"
  puts "Commands: sh, debugger, up, down, logs, db_clean"
  exit 1
end

command = ARGV.join(' ')

app_name = File.basename(File.expand_path('..', __dir__))
service_name = "web-rails"

case command
when "sh"
  system("docker-compose run --rm #{service_name} bash")
when "debugger"
  system("docker-compose up -d && docker attach #{app_name}-#{service_name}-1")
when "up"
  system("docker-compose up")
when "down"
  system("docker-compose down")
when "logs"
  system("docker-compose logs -f")
when "db_clean"
  system("docker-compose run --rm #{service_name} bash -c 'bin/rails db:drop db:create db:migrate db:seed'")
else
  system("docker-compose run --rm #{service_name} bash -c 'bundle exec #{command}'")
end
